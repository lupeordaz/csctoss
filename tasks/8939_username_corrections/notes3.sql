--    UPDATE unique_identifier
--       SET value = var_myrow.user_prefix
--     WHERE equipment_id = var_myrow.equip_id
--       AND unique_identifier_type = 'MIN';



2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752NOTICE:  Equipment Id:  13
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752NOTICE:  Username:      3122177187
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752LOG:  statement: UPDATE unique_identifier SET value =  $1  WHERE equipment_id =  $2  AND unique_identifier_type = 'MIN'
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752CONTEXT:  SQL statement "UPDATE unique_identifier SET value =  $1  WHERE equipment_id =  $2  AND unique_identifier_type = 'MIN'"
  PL/pgSQL function "username_correct" line 28 at SQL statement
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752LOG:  statement: SELECT indkey FROM pg_index WHERE indisprimary='t' AND indrelid=214846414
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752CONTEXT:  SQL statement "SELECT indkey FROM pg_index WHERE indisprimary='t' AND indrelid=214846414"
  SQL statement "UPDATE unique_identifier SET value =  $1  WHERE equipment_id =  $2  AND unique_identifier_type = 'MIN'"
  PL/pgSQL function "username_correct" line 28 at SQL statement
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752ERROR:  duplicate key violates unique constraint "unique_identifier_type_value_uk"
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752CONTEXT:  SQL statement "UPDATE unique_identifier SET value =  $1  WHERE equipment_id =  $2  AND unique_identifier_type = 'MIN'"
  PL/pgSQL function "username_correct" line 28 at SQL statement
2018-10-30 17:22:29 MDT 10.249.17.102(58662) csctoss_owner 20245 5066752STATEMENT:  select * from username_correct();




 upd_equip_id | correct_min |    exist_min    | related_equip_id | related_min 
--------------+-------------+-----------------+------------------+-------------
        12475 | 3122171493  | 3125460271      |             6820 | 3122171493
        12561 | 3122172154  | 3123885928      |            12350 | 3122172154
        12210 | 3122172789  | 3122174453      |            12380 | 3122172789
         5231 | 3122173584  | 3123888496      |             4862 | 3122173584
         8479 | 3122175583  | 3125462473      |             4888 | 3122175583
         4717 | 3122175758  | 3125467945      |             4899 | 3122175758
        14865 | 3122176134  | 3124372959      |            12165 | 3122176134
        18938 | 3122176139  | 3126710812      |            12166 | 3122176139
        32449 | 3122176139  | 000009134037169 |            12166 | 3122176139
           13 | 3122177187  | 3122175394      |               19 | 3122177187
         6306 | 3122177384  | 3123887982      |             3240 | 3122177384
         8848 | 3122178284  | 3124374234      |             3314 | 3122178284
        12079 | 3122178329  | 3124375357      |             5108 | 3122178329
        13728 | 3122179323  | 3124376069      |             6905 | 3122179323
         7423 | 3122179705  | 3123889517      |             4913 | 3122179705
        13491 | 3123885183  | 3124375779      |             6866 | 3123885183
        13527 | 3123885709  | 3124375828      |            13143 | 3123885709
         8124 | 3123885928  | 3126711318      |            12561 | 3123885928
         7142 | 3123886662  | 3124371389      |            12404 | 3123886662
         4769 | 3123887145  | 3125467711      |             5811 | 3123887145
        11955 | 3123887195  | 3124375192      |             5839 | 3123887195
         7797 | 3123887392  | 3122174690      |             5983 | 3123887392
         5133 | 3123887508  | 3125467417      |             6048 | 3123887508
         5811 | 3123887576  | 3123887145      |             6083 | 3123887576
         4250 | 3123887649  | 3125468295      |             6130 | 3123887649
         4871 | 3123887726  | 3122173792      |             6159 | 3123887726
         5724 | 3123887810  | 3123889056      |             6180 | 3123887810
        15030 | 3123887812  | 3124373211      |             6224 | 3123887812
        18322 | 3123887842  | 3129963837      |             6233 | 3123887842
         5492 | 3123888012  | 3123889106      |            13144 | 3123888012
         4970 | 3123888384  | 3125467592      |             5228 | 3123888384
        12255 | 3123888740  | 3123888419      |             5361 | 3123888740
        11797 | 3123888765  | 3124374987      |             5371 | 3123888765
         7241 | 3123889126  | 3125464778      |             5746 | 3123889126
        20882 | 3123889209  | 3128545251      |             5540 | 3123889209
        28336 | 3123889209  | 000009172236612 |             5540 | 3123889209
        11748 | 3123889231  | 3124374927      |             5555 | 3123889231
         3667 | 3123889235  | 3125469379      |             5559 | 3123889235
        16263 | 3123889517  | 3124377275      |             7423 | 3123889517
         4775 | 3123889583  | 3125467705      |             7468 | 3123889583
         3545 | 3123889606  | 3125469531      |             7478 | 3123889606
        16208 | 3123889657  | 3124377206      |             7512 | 3123889657
         7939 | 3123889696  | 3125463011      |             7534 | 3123889696
         4406 | 3123889768  | 3125468237      |             7595 | 3123889768
         4422 | 3124370678  | 3125468317      |             7231 | 3124370678
         5000 | 3124370748  | 3125467562      |             7250 | 3124370748
         5361 | 3124370873  | 3123888740      |             7321 | 3124370873
         8564 | 3124370941  | 3125462085      |             7350 | 3124370941
         5305 | 3124370962  | 3123888651      |             7366 | 3124370962
         4257 | 3124371175  | 3125468366      |             7026 | 3124371175
         4968 | 3124371338  | 3125467594      |             7104 | 3124371338
        16641 | 3124371389  | 3124377785      |             7142 | 3124371389
         8133 | 3124371587  | 3124371476      |             8209 | 3124371587
        16193 | 3124371602  | 3124377187      |             8222 | 3124371602
        11987 | 3124371631  | 3124375237      |             8239 | 3124371631
         8704 | 3124371719  | 3125461546      |            11760 | 3124371719
        19452 | 3124372314  | 3126712689      |            14402 | 3124372314
        16002 | 3124372594  | 3124373939      |            14594 | 3124372594
         8700 | 3124372597  | 3125461561      |            14597 | 3124372597
         3522 | 3124372637  | 3125469554      |            14621 | 3124372637
         3777 | 3124372637  | 3125469602      |            14621 | 3124372637
        18680 | 3124372637  | 3129962659      |            14621 | 3124372637
        19118 | 3124372670  | 3126712129      |            14647 | 3124372670
        18689 | 3124372750  | 3126710294      |            14704 | 3124372750
        15366 | 3124372806  | 3122174509      |            14745 | 3124372806
        12583 | 3124373340  | 3125460221      |            15104 | 3124373340
        16991 | 3124373596  | 3124378214      |            15734 | 3124373596
        19973 | 3124373596  | 3126711902      |            15734 | 3124373596
        20662 | 3124373787  | 3128545906      |            15870 | 3124373787
        41656 | 3124373787  | 5666968516      |            15870 | 3124373787
        18770 | 3124373807  | 3126710480      |            15888 | 3124373807
        12049 | 3124374025  | 3126711359      |             8001 | 3124374025
         3913 | 3124374816  | 3125469056      |            11702 | 3124374816
        36848 | 3124374816  | 5007214616      |            11702 | 3124374816
         8678 | 3124374964  | 3125461648      |            11776 | 3124374964
         7711 | 3124374973  | 3125461224      |            11784 | 3124374973
        22609 | 3124374973  | 000009135851141 |            11784 | 3124374973
         5187 | 3124375345  | 3125467363      |            12069 | 3124375345
        15070 | 3124375346  | 3124373272      |            12070 | 3124375346
         5733 | 3124375403  | 3123889079      |            12119 | 3124375403
         6947 | 3124375560  | 3125465201      |            13322 | 3124375560
        16308 | 3124375603  | 3124377329      |            13355 | 3124375603
         7919 | 3124375706  | 3125463084      |            13430 | 3124375706
         8531 | 3124375706  | 3125462213      |            13430 | 3124375706
        12431 | 3124375925  | 3123886956      |            13602 | 3124375925
         8604 | 3124376028  | 3125461948      |            13694 | 3124376028
        12023 | 3124376589  | 3124375286      |            14143 | 3124376589
        12391 | 3124376603  | 3123886245      |            14156 | 3124376603
        12591 | 3124376654  | 3125460213      |            14196 | 3124376654
        36552 | 3124376657  | 4046158488      |            14199 | 3124376657
        18648 | 3124376813  | 3129962753      |            15560 | 3124376813
         7330 | 3124376949  | 3124370887      |            15679 | 3124376949
         5626 | 3124377023  | 3123889384      |            16055 | 3124377023
        12405 | 3124377031  | 3123886672      |            16061 | 3124377031
        11722 | 3124377174  | 3124374881      |            16183 | 3124377174
        16694 | 3124377187  | 3124377856      |            16193 | 3124377187
        19149 | 3124377199  | 3126712169      |            16205 | 3124377199
        15100 | 3124377206  | 3124373334      |            16208 | 3124377206
        16727 | 3124377211  | 3124377894      |            16212 | 3124377211
         4106 | 3124377234  | 3125468816      |            16229 | 3124377234
        13713 | 3124377265  | 3124376051      |            16255 | 3124377265
         4646 | 3124377723  | 3125467989      |            16599 | 3124377723
        12454 | 3124377723  | 3125460292      |            16599 | 3124377723
        12564 | 3124377856  | 3123885964      |            16694 | 3124377856
         7719 | 3124377868  | 3125461188      |            16704 | 3124377868
        20078 | 3124377868  | 000006465560835 |            16704 | 3124377868
         7540 | 3124377873  | 3123889706      |            16709 | 3124377873
        14204 | 3124377901  | 3124372015      |            16731 | 3124377901
        12194 | 3124377937  | 3125460335      |            16761 | 3124377937
        13322 | 3124378056  | 3124375560      |            16860 | 3124378056
         6691 | 3124378231  | 3125466009      |            17005 | 3124378231
        37033 | 3124378231  | 4045489137      |            17005 | 3124378231
        37114 | 3124378231  | 4045489079      |            17005 | 3124378231
        20402 | 3124378302  | 000009173343944 |            17066 | 3124378302
        15660 | 3124378537  | 3124376929      |            17269 | 3124378537
        16262 | 3124378627  | 3124377274      |            17347 | 3124378627
        14869 | 3124378726  | 3124372963      |            17432 | 3124378726
        20155 | 3124378737  | 000003157154568 |            17440 | 3124378737
        23134 | 3124379052  | 000009174058977 |            15435 | 3124379052
         6795 | 3124379060  | 3122176283      |            15442 | 3124379060
         3551 | 3124379065  | 3125469525      |            15447 | 3124379065
        14663 | 3125462071  | 3124372689      |             8571 | 3125462071
         5959 | 3125462166  | 3123887349      |             8545 | 3125462166
        11761 | 3125462213  | 3124374944      |             8531 | 3125462213
         7534 | 3125462492  | 3123889696      |             8474 | 3125462492
        16690 | 3125462723  | 3124377852      |             7989 | 3125462723
        14807 | 3125463048  | 3124372890      |             7927 | 3125463048
        19579 | 3125463048  | 3126711239      |             7927 | 3125463048
         7036 | 3125463084  | 3124371192      |             7919 | 3125463084
         4546 | 3125464558  | 3125468110      |             7649 | 3125464558
         4991 | 3125465096  | 3125467571      |             6962 | 3125465096
         8621 | 3125465201  | 3125461869      |             6947 | 3125465201
        14143 | 3125465839  | 3124376589      |             6739 | 3125465839
         5967 | 3125466035  | 3123887363      |             6685 | 3125466035
         3381 | 3125467371  | 3125469861      |             5179 | 3125467371
         5001 | 3125467371  | 3125467561      |             5179 | 3125467371
        18813 | 3125467562  | 3126710565      |             5000 | 3125467562
         6217 | 3125467592  | 3123887764      |             4970 | 3125467592
         7939 | 3125467677  | 3125463011      |             4803 | 3125467677
        12561 | 3125467677  | 3123885928      |             4803 | 3125467677
        18276 | 3125467677  | 3129963997      |             4803 | 3125467677
        20715 | 3125467686  | 3128545726      |             4794 | 3125467686
        27283 | 3125467686  | 000009139274050 |             4794 | 3125467686
         5023 | 3125467716  | 3125467539      |             4764 | 3125467716
         4661 | 3125467724  | 3125468058      |             4756 | 3125467724
         4869 | 3125467724  | 3122173729      |             4756 | 3125467724
         6866 | 3125467945  | 3123885183      |             4717 | 3125467945
        14609 | 3125467981  | old-3124372617  |             4632 | 3125467981
        14145 | 3125467985  | 3124376591      |             4662 | 3125467985
        14739 | 3125467989  | 3124372796      |             4646 | 3125467989
        20162 | 3125468098  | 000003157154577 |             4675 | 3125468098
        14510 | 3125468213  | 3124372479      |             4316 | 3125468213
         5209 | 3125468340  | 3128541082      |             4304 | 3125468340
         5428 | 3125468997  | 3123888940      |             3965 | 3125468997
         3824 | 3125469320  | 3128541789      |             3730 | 3125469320
        27780 | 3125469320  | 000009175486353 |             3730 | 3125469320
         5139 | 3125469369  | 3123885153      |             3688 | 3125469369
         5338 | 3125469377  | 3123888705      |             3669 | 3125469377
        18503 | 3125469379  | 000009172142778 |             3667 | 3125469379
         5579 | 3125469386  | 3123889267      |             3660 | 3125469386
         5371 | 3125469460  | 3123888765      |             3594 | 3125469460
         6034 | 3125469761  | 3123887483      |             3483 | 3125469761
         8750 | 3125469782  | 3124370411      |             3462 | 3125469782
         5999 | 3126710460  | 3123887413      |            18756 | 3126710460
        20565 | 3126710681  | 3128546309      |            18870 | 3126710681
         5751 | 3126711162  | 3123889146      |            19561 | 3126711162
        13871 | 3126711174  | 3124376246      |            19570 | 3126711174
        19659 | 3126711178  | 3126711380      |            19571 | 3126711178
        17218 | 3126711242  | 3124378481      |            19581 | 3126711242
        18157 | 3126711273  | 3129964583      |            19593 | 3126711273
        14873 | 3126711276  | 3124372968      |            19594 | 3126711276
        19809 | 3126711296  | 3126711637      |            19605 | 3126711296
        16630 | 3126711308  | 3124377760      |            19612 | 3126711308
        11791 | 3126711313  | 3124372867      |            19616 | 3126711313
         4990 | 3126711318  | 3125467572      |             8124 | 3126711318
        14080 | 3126711326  | 3124376515      |            19623 | 3126711326
        16065 | 3126711330  | 3124377035      |            19626 | 3126711330
         8139 | 3126711334  | 3124371484      |            19628 | 3126711334
        13516 | 3126711334  | 3124375816      |            19628 | 3126711334
        17021 | 3126711335  | 3124378248      |            19629 | 3126711335
         8575 | 3126711336  | 3125462052      |             5457 | 3126711336
        19889 | 3126711339  | 3126711768      |            19632 | 3126711339
        12364 | 3126711341  | 3122172472      |            19633 | 3126711341
         5684 | 3126711343  | 3123887061      |            19635 | 3126711343
         6704 | 3126711343  | 3125465947      |            19635 | 3126711343
        19968 | 3126711356  | 3126711894      |            19639 | 3126711356
         8010 | 3126711373  | 3124374042      |            19653 | 3126711373
         5907 | 3126711378  | 3123887307      |            19657 | 3126711378
        17238 | 3126711380  | 3124378503      |            19659 | 3126711380
        19705 | 3126711512  | 3126711459      |            19729 | 3126711512
         5574 | 3126711530  | 3123889258      |            19738 | 3126711530
        14722 | 3126712028  | 3124372773-OLD  |            19060 | 3126712028
         7482 | 3126712072  | 3123889610      |            19091 | 3126712072
        23245 | 3126712089  | 000009176532135 |            19106 | 3126712089
        23281 | 3126712089  | 000009176531847 |            19106 | 3126712089
        18140 | 3126712134  | 3129964663      |            19122 | 3126712134
        20792 | 3126712169  | 3128545457      |            19149 | 3126712169
        41655 | 3126712169  | 5666968514      |            19149 | 3126712169
         6186 | 3126712314  | 3123887822      |            19228 | 3126712314
         8537 | 3126712331  | 3125462196      |            19233 | 3126712331
        18355 | 3126712339  | 000009172141645 |            19235 | 3126712339
        11890 | 3126712351  | 3124375112      |            19243 | 3126712351
         5711 | 3126712352  | 3125463353      |            19244 | 3126712352
        12522 | 3126712355  | 3123885348      |            19246 | 3126712355
         8751 | 3126712361  | 3125461387      |            19250 | 3126712361
        14513 | 3126712365  | 3124372483      |             7069 | 3126712365
         3158 | 3126712439  | 3123886887      |            19297 | 3126712439
         4007 | 3126712527  | 3125468945      |            19347 | 3126712527
         8784 | 3126712527  | 3125460591      |            19347 | 3126712527
         5445 | 3126712563  | 3123888967      |            19373 | 3126712563
        12002 | 3126712657  | 3124375257      |            19430 | 3126712657
        18756 | 3126712657  | 3126710460      |            19430 | 3126712657
         4156 | 3128541362  | 3125468785      |             3830 | 3128541362
        20779 | 3128546004  | 3128545492      |            20649 | 3128546004
        20739 | 3128546015  | 3128545654      |            20642 | 3128546015
        20758 | 3128546028  | 3128545566      |            20637 | 3128546028
        20740 | 3128546078  | 3128545653      |            20617 | 3128546078
        20733 | 3128546081  | 3128545678      |            20614 | 3128546081
        20755 | 3128547122  | 3128545576      |            20489 | 3128547122
        20736 | 3128547137  | 3128545673      |            20654 | 3128547137
        20730 | 3129962659  | 3128545686      |            18680 | 3129962659
        32162 | 3129962659  | 000009172771796 |            18680 | 3129962659
        12069 | 3129963837  | 3124375345      |            18322 | 3129963837
        16860 | 3129964306  | 3124378056      |            18220 | 3129964306
        12166 | 3129964596  | 3122176139      |            18154 | 3129964596
        20054 | 3129964612  | 3129961510      |            18153 | 3129964612
(226 rows)

--
 upd_equip_id | correct_min |    exist_min    | related_equip_id | related_min 
--------------+-------------+-----------------+------------------+-------------
           13 | 3122177187  | 3122175394      |               19 | 3122177187
        12475 | 3122171493  | 3125460271      |             6820 | 3122171493
        12561 | 3122172154  | 3123885928      |            12350 | 3122172154
        12210 | 3122172789  | 3122174453      |            12380 | 3122172789
         5231 | 3122173584  | 3123888496      |             4862 | 3122173584
         8479 | 3122175583  | 3125462473      |             4888 | 3122175583
         4717 | 3122175758  | 3125467945      |             4899 | 3122175758
        14865 | 3122176134  | 3124372959      |            12165 | 3122176134
        18938 | 3122176139  | 3126710812      |            12166 | 3122176139
        32449 | 3122176139  | 000009134037169 |            12166 | 3122176139


 equipment_id | unique_identifier_type |   value    | notes | date_created | date_modified 
--------------+------------------------+------------+-------+--------------+---------------
           13 | MIN                    | 3122175394 |       | 2008-01-08   | 
           19 | MIN                    | 3122177187 |       | 2008-01-08   | 
(2 rows)



begin;

select public.set_change_log_staff_id(3);

update unique_identifier
   set value = '99991'
 where equipment_id = 19
   and unique_identifier_type = 'MIN';

update unique_identifier  
   set value = '3122177187'
 where equipment_id = 13
   and unique_identifier_type = 'MIN';

update unique_identifier
   set value = '3122175394'
 where equipment_id = 19
   and unique_identifier_type = 'MIN';







